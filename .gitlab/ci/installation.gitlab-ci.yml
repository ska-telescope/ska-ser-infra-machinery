.installation_base_job:
  stage: installation
  variables:
    JOB: installation
    CI_PIPELINE_ID: $CI_PIPELINE_ID
  before_script:
    - !reference [.install_python_dependencies]
    - !reference [.install_secrets]

.logging_install_task:
  variables:
    TASK: install
    REINSTALL: "false"
  script: |
    if [ "$REINSTALL" = "true" ]; then
    cat <<EOF > cicd-extra-vars.yml
    elasticsearch_reinstall: true
    elasticsearch_exporter_reinstall: true
    kibana_reinstall: true
    EOF
      echo "ANSIBLE_PLAYBOOK_ARGUMENTS='-e @$(pwd)/cicd-extra-vars.yml' make playbooks logging install"
    else
      echo "make playbooks logging install"
    fi

.logging_destroy_task:
  variables:
    TASK: destroy
  script:
    - echo 'make playbooks logging destroy'

.logging_test_task:
  stage: test
  variables:
    TASK: test
  script:
    - echo 'make playbooks logging test'