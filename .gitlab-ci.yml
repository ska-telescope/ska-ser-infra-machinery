image: $SKA_K8S_TOOLS_BUILD_DEPLOY_ALPINE

variables:
  GIT_SUBMODULE_STRATEGY: recursive

stages:
  - lint
  - test

test-runner:
  stage: test
  tags:
    - ska-techops-iac-gitlab-runner
  script:
    - make orch init
    - TF_HTTP_USERNAME="domingosnunes" TF_HTTP_PASSWORD="glpat-KPszpYThf1za8ZcSKrjf" ENVIRONMENT="stfc-techops" make orch plan

include:
- project: 'ska-telescope/templates-repository'
  file: 'gitlab-ci/includes/terraform.gitlab-ci.yml'
- project: 'ska-telescope/templates-repository'
  file: 'gitlab-ci/includes/finaliser.gitlab-ci.yml'